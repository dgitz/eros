#DO NOT EDIT THIS FILE.  IT IS MAINTAINED THROUGH EROS.
#!/bin/bash
#Author: David Gitz
#Purpose: Launches Software on all Devices

declare -a Devices=("ControlModule1" "ControlModule2" "dgitzrosmaster")

function launch_device_remote ()
{
    ping -w 1 $1
    RETVAL=$?
    if [ $RETVAL -eq 0 ]; then
        #Remote in to device
        echo "Going to Remote Launch: roslaunch icarus_rover_v2 "$1".launch"
        launch_command="cd ~ && screen -dmS robot ./scripts/launchDevice -d $1"
        #echo $launch_command
        ssh robot@$1 $launch_command
    else
        echo "Device: "$1" Not Found."
    fi
}

function launch_device_local ()
{
    #echo "Going to Local Launch: roslaunch icarus_rover_v2 "$1".launch"
    echo "Launching on Local Device"
    launch_command="cd ~ && screen -dmS robot ./scripts/launchDevice -d $1"
    eval $launch_command
}

function launch_all_devices()
{
    echo "Stopping all tasks first."
    (exec "/home/robot/scripts/stopSystem" )
    echo "Launching on all Devices"
    for device in "${Devices[@]}"
    do
        if [ $device != $HOSTNAME ]; then
            launch_device_remote $device
        else
            launch_device_local $device
        fi
    done
    exit 0
}
#No arguments present.  Launch everywhere.
launch_all_devices

